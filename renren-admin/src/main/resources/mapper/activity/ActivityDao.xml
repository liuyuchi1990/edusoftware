<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.activity.dao.ActivityDao">

    <select id="queryAllTemplate"
            resultType="io.renren.modules.activity.entity.ActivityEntity">
        select t.* from tb_activity t
        left join sys_user u on t.create_user = u.user_id
        where u.mobile in ('18652043832','17512528181','15252778892')
        <if test="list!= null">
        <foreach collection="list"  item="item" open="and t.id in (" separator="," close=")"  >
        #{item}
        </foreach>
        </if>
        limit #{pageNum,jdbcType=INTEGER},#{pageSize,jdbcType=INTEGER}
    </select>

    <update id="updateActivityState" parameterType="io.renren.modules.activity.entity.ActivityEntity">
        update tb_activity
        <set>
            <if test="shareNum!= null and shareNum!=0">
                share_num =  share_num + 1,
            </if>
            <if test="viewNum!= null and viewNum!=0">
                view_num =  view_num + 1,
            </if>
            <if test="useNum!= null and useNum!=0">
                use_num =  view_num + 1,
            </if>
            <if test="likeNum!= null and likeNum!=0">
                like_num =  like_num + #{likeNum},
            </if>
        </set>
        where id = #{id,jdbcType=VARCHAR}
    </update>

    <update id="updateLikeState" parameterType="io.renren.modules.activity.entity.ActivityEntity">
        update tb_like
        <set>
            <if test="likeNum==1">
                likeflag =  likeflag + 1,
            </if>
            <if test="likeNum==-1">
                likeflag =  likeflag - 1,
            </if>
            update_time = SYSDATE()
        </set>
        where activity_id = #{id,jdbcType=VARCHAR} and user_id = #{createUser}
    </update>

    <insert id="insertLikeState" parameterType="io.renren.modules.activity.entity.ActivityEntity">
        INSERT INTO tb_like(likeflag, user_id, create_time, activity_id, id)
	VALUES (
		#{likeNum,jdbcType=VARCHAR},
		#{createUser,jdbcType=VARCHAR},
		SYSDATE(),
		#{id,jdbcType=VARCHAR},
		#{templateId,jdbcType=VARCHAR}
	)
    </insert>

    <select id="queryLikeByUserIdAndActivityId" parameterType="io.renren.modules.activity.entity.ActivityEntity"
            resultType="java.util.HashMap">

        select * from tb_like where user_id = #{createUser,jdbcType=VARCHAR}and activity_id = #{id,jdbcType=VARCHAR}

    </select>
</mapper>